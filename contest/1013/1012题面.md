# [NOIP2018 普及组] 对称二叉树  tree.cpp   时间限制: 1000 ms     内存限制: 262144 KB

## 题目描述

一棵有点权的有根树如果满足以下条件，则被轩轩称为对称二叉树： 

1.  二叉树； 
2.  将这棵树所有节点的左右子树交换，新树和原树对应位置的结构相同且点权相等。   

下图中节点内的数字为权值，节点外的 $id$ 表示节点编号。  

![](https://cdn.luogu.com.cn/upload/pic/43192.png)   

现在给出一棵二叉树，希望你找出它的一棵子树，该子树为对称二叉树，且节点数 最多。请输出这棵子树的节点数。   

注意：只有树根的树也是对称二叉树。本题中约定，以节点 $T$ 为子树根的一棵“子 树”指的是：节点$T$ 和它的全部后代节点构成的二叉树。

## 输入格式

第一行一个正整数 $n$，表示给定的树的节点的数目，规定节点编号 $1 \sim n$，其中节点 $1$ 是树根。 

第二行 $n$ 个正整数，用一个空格分隔，第 $i$ 个正整数 $v_i$ 代表节点 $i$ 的权值。 

接下来 $n$ 行，每行两个正整数 $l_i, r_i$，分别表示节点 $i$ 的左右孩子的编号。如果不存在左 / 右孩子，则以 $-1$ 表示。两个数之间用一个空格隔开。

## 输出格式

输出文件共一行，包含一个整数，表示给定的树的最大对称二叉子树的节点数。

## 样例 #1

### 样例输入 #1

```
2 
1 3 
2 -1 
-1 -1
```

### 样例输出 #1

```
1
```

## 样例 #2

### 样例输入 #2

```
10 
2 2 5 5 5 5 4 4 2 3 
9 10 
-1 -1 
-1 -1 
-1 -1 
-1 -1 
-1 2 
3 4 
5 6 
-1 -1 
7 8
```

### 样例输出 #2

```
3
```

## 提示

【输入输出样例 1 说明】  
![](https://cdn.luogu.com.cn/upload/pic/43188.png)     
最大的对称二叉子树为以节点 $2$ 为树根的子树，节点数为 $1$。   

【输入输出样例 2 说明】   
![](https://cdn.luogu.com.cn/upload/pic/43189.png)     
最大的对称二叉子树为以节点 $7$ 为树根的子树，节点数为 $3$。 

【数据规模与约定】    
共 $25$ 个测试点。    
$v_i ≤ 1000$。   
测试点 $1 \sim 3, n ≤ 10$，保证根结点的左子树的所有节点都没有右孩子，根结点的右 子树的所有节点都没有左孩子。   
测试点 $4 \sim 8, n ≤ 10$。  
测试点 $9 \sim 12, n ≤ 10^5$，保证输入是一棵“满二叉树” 。   
测试点 $13 \sim 16, n ≤ 10^5$，保证输入是一棵“完全二叉树”。  
测试点 $17 \sim 20, n ≤ 10^5$，保证输入的树的点权均为 $1$。  
测试点 $21 \sim 25, n ≤ 10^6$。 

本题约定： 

层次：节点的层次从根开始定义起，根为第一层，根的孩子为第二层。树中任一节 点的层次等于其父亲节点的层次加 $1$。 

 树的深度：树中节点的最大层次称为树的深度。 

 满二叉树：设二叉树的深度为 $h$，且二叉树有 $2^h-1$ 个节点，这就是满二叉树。  
 ![](https://cdn.luogu.com.cn/upload/pic/43190.png)  
完全二叉树：设二叉树的深度为 $h$，除第 $h$ 层外，其它各层的结点数都达到最大 个数，第 $h$ 层所有的结点都连续集中在最左边，这就是完全二叉树。  
 ![](https://cdn.luogu.com.cn/upload/pic/43191.png)

# [NOIP2014 提高组] 联合权值   时间限制: 1000 ms     内存限制: 131072 KB   link.cpp

## 题目描述

无向连通图 $G$ 有 $n$ 个点，$n-1$ 条边。点从 $1$ 到 $n$ 依次编号,编号为 $i$ 的点的权值为 $W_i$，每条边的长度均为 $1$。图上两点 $(u, v)$ 的距离定义为 $u$ 点到 $v$ 点的最短距离。对于图 $G$ 上的点对 $(u, v)$，若它们的距离为 $2$，则它们之间会产生$W_v \times W_u$ 的联合权值。

请问图 $G$ 上所有可产生联合权值的有序点对中，联合权值最大的是多少？所有联合权值之和是多少？

## 输入格式

第一行包含 $1$ 个整数 $n$。

接下来 $n-1$ 行,每行包含 $2$ 个用空格隔开的正整数 $u,v$，表示编号为 $u$ 和编号为 $v$ 的点之间有边相连。

最后 $1$ 行,包含 $n$ 个正整数，每两个正整数之间用一个空格隔开，其中第 $i$ 个整数表示图 $G$ 上编号为 $i$ 的点的权值为 $W_i$。

## 输出格式

输出共 $1$ 行,包含 $2$ 个整数，之间用一个空格隔开,依次为图 $G$ 上联合权值的最大值和所有联合权值之和。由于所有联合权值之和可能很大，输出它时要对$10007$取余。

## 样例 #1

### 样例输入 #1

```
5  
1 2  
2 3
3 4  
4 5  
1 5 2 3 10
```

### 样例输出 #1

```
20 74
```

## 提示

![](https://cdn.luogu.com.cn/upload/pic/1347.png) 

本例输入的图如上所示，距离为2 的有序点对有$( 1,3)$ 、$( 2,4)$ 、$( 3,1)$ 、$( 3,5) $、$( 4,2)$ 、$( 5,3) $。

其联合权值分别为2 、15、2 、20、15、20。其中最大的是20，总和为74。


【数据说明】

对于30%的数据，$1 < n \leq 100$；

对于60%的数据，$1 < n \leq 2000$；

对于100%的数据，$1 < n \leq 200000, 0 < W_i \leq 10000$。

保证一定存在可产生联合权值的有序点对。

# 刷墙  print.cpp 

## 题目描述

Farmer John已经设计了一种方法来装饰谷仓旁边的长栅栏（把栅栏认为是一根一维的线）。他把一只画刷绑在他最喜爱的奶牛Bessie身上，之后就去喝一杯冰水，而Bessie隔着栅栏来回走，当她走过某个地方，这里的一段栅栏就被刷上了涂料。

Bessie从栅栏上的位置0开始，并且遵循着一个N次移动的次序(1 <= N <= 100,000)。例如“10 L”表示Bessie向左移动了10个单位长度，“15 R”表示Bessie向右移动了15个单位长度。现给出Bessie所有移动的列表，Farmer John想要知道哪些区域的栅栏至少涂了两层涂料（只涂一层涂料的区域可能在大雨中被洗掉）。Bessie在她的行走中最远到达距起始点1,000,000,000个单位长度。

## 输入格式

第1行：一个整型数N。

第2..N+1行：每行描述了Bessie的N次移动中的一次，例如“15 L”。

## 输出格式

1行：被至少涂了两层涂料的区域总数。

## 样例 #1

### 样例输入 #1

```
6
2 R
6 L
1 R
8 L
1 R
2 R
```

### 样例输出 #1

```
6
```

## 提示

【样例解释】

Bessie从位置0开始，向右移动2个单位长度，向左移动6个单位长度，向右移动1个单位长度，向左移动8个单位长度，最后向右移动3个单位长度。

6个单位区域至少被涂了两层涂料，是 [-11,-8], [-4,-3], [0,2]这些区域。

**本题数据由WINDOWS端构建，请自行过滤"\r"**

# [NOIP2006 提高组] 能量项链  时间限制: 1000 ms     内存限制: 65536 KB  energy.cpp



## 题目描述

在 Mars 星球上，每个 Mars 人都随身佩带着一串能量项链。在项链上有 $N$ 颗能量珠。能量珠是一颗有头标记与尾标记的珠子，这些标记对应着某个正整数。并且，对于相邻的两颗珠子，前一颗珠子的尾标记一定等于后一颗珠子的头标记。因为只有这样，通过吸盘（吸盘是 Mars 人吸收能量的一种器官）的作用，这两颗珠子才能聚合成一颗珠子，同时释放出可以被吸盘吸收的能量。如果前一颗能量珠的头标记为 $m$，尾标记为 $r$，后一颗能量珠的头标记为 $r$，尾标记为 $n$，则聚合后释放的能量为 $m \times r \times n$（Mars 单位），新产生的珠子的头标记为 $m$，尾标记为 $n$。

需要时，Mars 人就用吸盘夹住相邻的两颗珠子，通过聚合得到能量，直到项链上只剩下一颗珠子为止。显然，不同的聚合顺序得到的总能量是不同的，请你设计一个聚合顺序，使一串项链释放出的总能量最大。

例如：设 $N=4$，$4$ 颗珠子的头标记与尾标记依次为 $(2,3)(3,5)(5,10)(10,2)$。我们用记号 $\oplus$ 表示两颗珠子的聚合操作，$(j \oplus k)$ 表示第 $j,k$ 两颗珠子聚合后所释放的能量。则第 $4$ 、 $1$ 两颗珠子聚合后释放的能量为：

$(4 \oplus 1)=10 \times 2 \times 3=60$。

这一串项链可以得到最优值的一个聚合顺序所释放的总能量为：

$((4 \oplus 1) \oplus 2) \oplus 3)=10 \times 2 \times 3+10 \times 3 \times 5+10 \times 5 \times 10=710$。

## 输入格式

第一行是一个正整数 $N$（$4 \le N \le 100$），表示项链上珠子的个数。第二行是 $N$ 个用空格隔开的正整数，所有的数均不超过 $1000$。第 $i$ 个数为第 $i$ 颗珠子的头标记（$1 \le i \le N$），当 $i<N$ 时，第 $i$ 颗珠子的尾标记应该等于第 $i+1$ 颗珠子的头标记。第 $N$ 颗珠子的尾标记应该等于第 $1$ 颗珠子的头标记。

至于珠子的顺序，你可以这样确定：将项链放到桌面上，不要出现交叉，随意指定第一颗珠子，然后按顺时针方向确定其他珠子的顺序。

## 输出格式

一个正整数 $E$（$E\le 2.1 \times 10^9$），为一个最优聚合顺序所释放的总能量。

## 样例 #1

### 样例输入 #1

```
4
2 3 5 10
```

### 样例输出 #1

```
710
```